package com.clinica.cadastro.domain.model;

import java.time.LocalDateTime;

import org.springframework.data.annotation.CreatedDate;
import org.springframework.format.annotation.DateTimeFormat;

import jakarta.persistence.Embedded;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.Table;
import lombok.Data;

@Data
@Entity
@Table(name = "medical_appointment")
public class MedicalAppointment {

	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;
	
	@Embedded
	private Doctor doctor;
	
	@Embedded
	private Patient patient;
	
	@Embedded
	private Procedure procedure;
	
	@DateTimeFormat(pattern = "dd/MM/yyyy HH:mm:ss")
	private LocalDateTime date;
	
	@CreatedDate
	private LocalDateTime createdDate;
	
	private LocalDateTime closeAppointment;
	
	private AppointmentStatus status = AppointmentStatus.CREATED;
	
	public void closeAppointment() {
		if(status.equals(AppointmentStatus.CREATED)) {
			this.status = AppointmentStatus.FINISHED;
			this.closeAppointment = LocalDateTime.now();
		}
	}
	
	public void canceledAppointment() {
		this.status = AppointmentStatus.CANCELED;
		this.closeAppointment = LocalDateTime.now();	
	}
	
	public boolean appointmenteIsCanceled() {
		if(status.equals(AppointmentStatus.CANCELED)) {
			return true;
		}
		return false;
	}
}
